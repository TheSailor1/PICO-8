pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
function _init()
	tmr=0
	routines={}
	
	deck={}
	deckcopy={}
	shfdeck={}
	shfdeckcopy={}
	hand={}
	handcopy={}
	suits={"hrt","dmd","clb","spd"}
	discards={}
	
	
	pos={}
	pos[1]={x=10,y=10,enabled=true}
	pos[2]={x=50,y=10,enabled=true}
	pos[3]={x=10,y=50,enabled=true}
	pos[4]={x=50,y=50,enabled=true}
	pos[5]={x=80,y=50,enabled=true}
	
	avai={}
	for i=1,#pos do
		add(avai,pos[i])
	end
	
	
	cursel=1
	
	--create deck
	mk_deck()
	--remove face cards (red)
	rm_faces()
	--make a copy / keep orig
	copy(deck,deckcopy)
	-- shuffle copy (a) into new 
	-- deck (b)
	-- del orig copy (a)
	shuffle(deckcopy,shfdeck)
	--make a copy of deck (b)
	--into new deck (c)
	copy(shfdeck,shfdeckcopy)
	
	--test deck
	shfdeckcopy={
		{rank=2,suit="hrt",remcard=false},
		{rank=3,suit="hrt",remcard=false},
		{rank=4,suit="hrt",remcard=false},
		{rank=14,suit="spd",remcard=false},
		{rank=2,suit="spd",remcard=false},
	}
	
	dealcards(4)
end

function _update()
	checkcur_5()
	
	cursel=mid(1,cursel,#avai)
	
	if btnp(❎) then
		pos[cursel].enabled=false
		deli(avai,cursel)
		deli(hand,cursel)
		cursel=1
	end
	
	if btnp(🅾️) then
		wait(130)
		
	end
end

function _draw()
	cls()
	
	drw_deck()
	drw_hand()
	
	for i=1,#pos do
		if pos[i].enabled then
		rect(
				pos[i].x,
				pos[i].y,
				pos[i].x+10,
				pos[i].y+10,
				12)
		end
	end
	
	circfill(
		avai[cursel].x,
		avai[cursel].y,
		3,
		8
	)
	
	local c
	for p=1,#pos do
		c=pos[p].enabled==true and 12 or 8
		print(
			"x:"..pos[p].x.." y:"..pos[p].y,
			80,
			80+(p*6),
			c)
	end
	
	
	? cursel,80,70,9
	
	for r in all(routines) do
		assert(coresume(r))
	end
end

function checkcur_5()
	if (btnp(➡️)) cursel+=1
	if (btnp(⬅️)) cursel-=1
end
-->8
--draws
function drw_deck()
	? "deck "..#deck,2,90,13
	? "dckcpy "..#deckcopy,2,96,13
	? "sdeck "..#shfdeck,2,102,13
	? "sdeckcpy "..#shfdeckcopy,2,108,13
	? "hand "..#hand,2,114,13
	? "handcpy "..#handcopy,2,120,13
end

function drw_hand()/Users/ic/Library/Application Support/pico-8/carts/PICO-8/scoundrel/new.p8
	for i=1,4 do
		if pos[i].enabled then
			rectfill(
				pos[i].x,pos[i].y,pos[i].x+20,pos[i].y+20,13
			)
		end
	end
end
-->8
--updates
-->8
--cards
function mk_deck()
	for s=1,4 do
		for r=2,14 do
			add(deck,{
				remcard=false,
				suit=suits[s],
				rank=r
			})
		end
	end
end

function rm_faces()
	for c in all(deck) do
		if c.suit=="hrt" or
					c.suit=="dmd" then
						if c.rank>10 then
							del(deck,c)
						end
		end
	end
end

function copy(tbl1,tbl2)
	for c=1,#tbl1 do
		--copy deck into deckcopy
		add(tbl2,tbl1[c])
	end
end

function shuffle(tbl1,tbl2) 
	for r=1,#tbl1 do
		local randcard=1+flr(rnd(#tbl1))
		add(tbl2,tbl1[randcard])
		deli(tbl1,randcard)
	end
end

function dealcards(v,ran)
	totcards=v
	--async(carddeal)
	for i=1,v do
		add(hand,shfdeckcopy[1])
		deli(shfdeckcopy,1)
	end
	
	if #handcopy==0 then
		copy(hand,handcopy)
	end
	
	if ran then
		hasrun=true
	else
		hasrun=false
	end
end

function discard(c)
	local current
	if (curx==1 and cury==1) current=1
	if (curx==2 and cury==1) current=2
	if (curx==1 and cury==2) current=3
	if (curx==2 and cury==2) current=4
	if (curx==3 and cury==3) current=5
	
	hand[current].remcard=true
	deli(avai,current)
	--cursel=1
end
-->8
--tools
function wait(f)
	if tmr>0 then
		tmr-=1
	else
		handcopy={}
		copy(hand,handcopy)
	end
end

function async(func)
	add(routines,cocreate(func))
end
__gfx__
7777777e00000000ee7777777777e77777777777777777777777777777777777777eeee7777777777777777eeeee777777777ee0dd0e00000e77777777777777
777777e0111133bb00e77777777e0e77eeeeeee77777e777777777777eeeee7777e0000e7777777777777ee00000ee777777e00dd660677770e7777777777777
77777e01111111133b0e777777e0d0ee0000000ee77e0e7777777777e00000ee7e0dddd077777777777ee005555500e7777e0ddddd667777670e777777777777
7777e0111111111113b0e7777e00d0e0322222200ee0d0e77777777e02dddd00e0dddddd7777777777e0055555555507777e0dddddd66666660e777777777777
7777e011111110011130ee77e0dd0e034aaa942240e0d0e77777777e0222ddd00ddd555d777777777e005555dddd55577770d666ddddddddd660e77777777777
7777e01101311070113000ee0d1100344aaa9942240d10e777eee7e02112d1100dd5111d77777777e005533333b33dd7770dd666dddddddddd600e7777777777
7777e0107131107011354a0e01dd003449aa9992241150e77e000ee021121135dd51111d7777777e0055d3bbbb3333d77e0dd6ddddddd11dddd0d0e777777777
7777e010711110001135490e05d1003499999a49241510e7e00dd0ee01111335dd5111dd777777e005533bbbdd3b33d77e0d6dddddddffdd1d60d0e777777777
7777e0100155100111350eee011dd1044999aa92221510e7e0d00e77e01333555d111ddd777777e00333333d33b3ddd7e0dd6d6dd00dff001dd0dce777777777
7777e01005111011133550e7e01515044499994422110e77e000e777e0333355555555d07777ee0053b111b3333d111ee0dddd6dd0000f000dddd0e777777777
7777e01151000701113350e7e011150444999a942400e777e0d0e777e03333500055550e777e00003b11001b33d1001000dddd7dd294ff2901dcd0e777777777
77777e01504440001133300e7e01110441144a41140e7777e000e77e03d355000005550e777e00113310440135104400d0ddd7dddfffffff01ddd0e777777777
77777e01507070001113110e77e0004441111a11140e7777e0d30eee0dd505070055550e777e01b3133049000100940e0ddd67dddfcffefe016c0e7777777777
7eee7e01500000011111310e777e044441880908840e77777e003000dd5505001d33550e777e01031330290100109207e06d67ddd5cffffe016dd0e777777777
e000ee01500002011111110e777e044444009940240ee77777e03300d5555001d333500e777e0000533002015010200e06ddd67ddd5f88ee0d66c0e777777777
01110e01500080111111110e77e000494440040024000e77777e00005555555dd335500e7777e010153100015010001e06dddd67ddd5fee0ddd6c0e777777777
01110e0115500051111111007e0f504944430002490550e77777ee0dd55555555552500077777e0011b311350001113e0616dddd76d55e01ddcc0d0777777777
11bb100111555511131311007e0f5001444400024905f0e77777e01d1155252055225000777777e0013bb333000533be0d16d1ddd6ddd011dccc0d0777777777
1bb3100111555111131111107e0ff501944430249105f0e77777e0011052550115220010777777e0055333335005533e0d16d1d1d666d115dccc00e777777777
11333111dfd1511113111110e00fff5019443044910f500e7777e0200228804108221110777777e0051551b33555d13e0d16d1551dd6dd15c66c000777777777
0111331dfddd511115511111033fff50124430491055ff007777e0022280014082211110777777e00305b11bbbdd1130016d113351dddddc6ff6cc0777777777
0111131d0d0d1111115515113330f5f000244044005fff00777e000000019100220511107777eee00305b104090411bd06dd1bbb3d11ddcc6ffff60777777777
e0111111d0d11111111155551133ff5f000220201055f03177e0110090914008205dd1107eee00e00b0531000f0010bdddd13bb31dd15dcc6fffe60777777777
7e0111115d11111111771555113305f555010001055ff0317e011d114242202205dd5330e00e00ee0001131400050010111313331dd15dccceeeec0777777777
7e0111155111111111cc11111113305555010001300003317e0d0d0d082000004dd55030e0000b0ee00103309f5500be0111d1331dd1bd0cccecc0e777777777
77e0111555511111167711111111110000110001333333117e0000e00800011d1dd50000e0bb0300e00100333350003e0331d1331d13bd50c3ee0e7777777777
7e001115055111117776111711111111111000001111111777e0e0ee0000d01dd50000d1e0330dd0000100005500000e0111dd11dd131d550bff0e7777777777
e00111500551111066601177777ccc777777777777777777777eeeeeeeeedddddddddd110001dd5d000000000000001e01111ddddd1111550b330e7777777777
00111000005111770001777777c000c77777777777777777777dddddddddddddddddddd700011155550000000555111011111111111111550bb30e7777777777
7777770990ee0ee000e777777c04450cc777777777777777777777777fffff7777777777777ffffffff777777777777fff777777777777777777777777777777
777777e090e0900aaa0e7777c004a4500cccc7777777777777777777f0000f777777777777ff000000f777777777fff000f77777777777777777777777777777
777777e0a0e09900aa0e7777c049aa4450000c77777777777777777f00000f77777777777f00000000f77777777f0007660f7777777777777777777777777777
77777e0a90e099099a0e7777c0499aa4444500c777777777777777f006600f7777777777f000c6d00f77777777f00c766d0f77ffff7777777777777777777777
7777e0aa99099999aaa0e7770c0499faa999040c777777777ff77f0067d00f777777777f0ccc7dd00f777777ff00c76ddd00ff000f7777777777777777777777
77770aa9999dddd99aaa0e770c00499aaaaa9900c7777777f00ff0067d00f777777777f00c776d00f777777f000c76dddd0000000f7777777777777777777777
77e0aaa99dd6666d99aa90e77cc0049faaaaa9050c77777f00000067d00f777777777f00cd76d00f777777f000776dd0dd500a900f7777777777777777777777
7e09a99d66667776d9a9a0e77c0500999aaaa9540c77777f044006cd00f7777777777f0cdd76d00f777777f00776d00d55505440f77777777777777777777777
7e0994d6666667776099990ec04450099faaf94000c7777f00490cd00f7777777777f007dd7dd0f7777777f0076dd00551115240f77777777777777777777777
7e094466666666776609990ec099445999ff9900490c7777f009a700f77fffff7777f0c77d7d00f7777777f006dd0d55511d2200f77777777777777777777777
e0940d666666167763d0490ec0f9944f999990499990c77f00929a00f7f0000f777f00777d6d00f77777777f00ddd55111dd51000f7777777777777777777777
e0940d66661006770130490ec0044444f99904990090c7f0092209900f00000f777f0077661d00f777777777f00055511dd5115000f777777777777777777777
e0940d666d000d770030490e0cc00044449004900090cf00922000400006600f777f0077661100f7777777777ff00011dd511150000f77777777777777777777
e0940dd6dd000d630030940e000ccc0044404900050c0f009200f0000067d00f777f00766d1100f777777777777f000dd511555ddd0077777777777777777777
7e040ddddd001d630130920e000000cc00004400540c0f0000000f00067d00f7777f00766d1100f77777777777f00000511555ddd66077777777777777777777
7e0440ddd3311d1313d0920e77700000ccc0445540c00f000000000067d00f77777f0076d11100f7777777777f00550011155dd0d66077777777777777777777
7ee0490d5533d1003350920e77770000000c04400c007fffff044006cd00f777fff000000000000f77777777f00552200555d00d666077777777777777777777
e0002290555dd100550920e7777777000000c00cc00077777f00490cd00f7777f0000000000000000077777f0055220005ddd0066c0077777777777777777777
011002220055d335002220e77777777700000cc00007777777f009a700f77777f009aaaaa9999994007777f0055220000ddd0d66c00f77777777777777777777
011000000d00737500000e777777777777700000007777777f00929a00f77777700499000000094400777f00552200ff00ddd66c00f777777777777777777777
011110000d0707000eeee777777777777777000007777777f0092209900f77777f004400444004400f77f009a2200f7f00d666000f7777777777777777777777
e00022100dd3335000e7777777777777777777777777777f00922000400f777777f0000099400000f77f00944400f777f000000ff77777777777777777777777
7ee0000220ddd350110e777777777777777777777777777f009200f000f77777777f00000000000f777f0554400f77777f0000f7777777777777777777777777
77e00404020000011420e77777777777777777777777777f00000f7fff7777777777d000445000d7777f022200f7777777ffff77777777777777777777777777
7e0024440022110124420e7777777777777777777777777f0000f777777777777777d009a95500d7777f02200f77777777777777777777777777777777777777
e00024442200101222420e7777777777777777777777777fffff7777777777777777d009aa5400d7777f0000f777777777777777777777777777777777777777
e002244222220112222200e7777777777777777777777777777777777777777777777d0009400d77777f000f7777777777777777777777777777777777777777
00224421122201112221000e7777777777777777777777777777777777777777777777d00000d777777ffff77777777777777777777777777777777777777777
00222211112201111111100077777777777777777777777777777777777777777777777d000d7777777777777777777777777777777777777777777777777777
7777777ff777777777777777777777ffff77777777777777777777777777777777777777ddd77777777777777777777777777777777777777777777777777777
777777f00ff777777777777777777f0000f777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777f00000f7777777777777777f0ff990f77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777f003000f777777777777777f094440f77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777f003bb00f7777777777777f00094000f7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777ff033bb0f777777777777f0070000c00f777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777f033300f77777777777f00d766cd00f777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
777777f0033300ff77777777777f00000000f7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777f0008358000ff777777777fff0d10fff7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777f0088885888000f7777777777f0d10f777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
777f088888851888800f77777777f00d500f77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77f0888811111122220f7777777f000d5000f7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7f008881881188822200f77777f000d7cd000f777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
f008888a9818888821200f777f006dc7cc1500f77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
f008289a9888888821200f77f00671ddd1c1500f7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
f002289a8898888221200f7f00676c111cccd500f777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
f00228889888882211200f7f0076c8822eccd500f777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
f00222888888822111200ff0077c8888e286dd500f77777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7f002288882222111200f7f007c7778e2226dd100f77777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7f00222222221111120f77f006c77788226ddc100f77777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77f0022111111112200f77f006c77721116ddc100f77777777777777777777777777777777777777777777777777777777777777777777777777777777777777
777f00022111122000f777f006c8822116ddcc100f77777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777f00002222000ff7777f700c882111dddcc001677777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777f000000000f7777777f006c82111ddc61001677777777777777777777777777777777777777777777777777777777777777777777777777777777777777
777777ff000000f777777777d001c882ddd610011677777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777ffffff7777777777d1001cccccc100111677777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777d100011110001116777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777d110000001111d7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
777777777777777777777777777dd1111111d6677777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777dddddddd7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
